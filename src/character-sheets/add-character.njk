---
title: Add Character
layout: layouts/sidebar.njk
---

<div class="stack">
  <h2>
    Add Character
  </h2>
  <form id="addCharacterForm" class="stack">
    <div>
      <label for="name">
        Character Name
      </label>
      <input id="name" type="text" name="name" autocapitalize="on" autofill="false" autocomplete="off" style="max-width: 30ch" required>
    </div>
    <div>
      <button type="submit">
        Save and Continue
      </button>
    </div>
  </form>
</div>

<script type="module">
  import { addToDb } from '/scripts/db.mjs';

  const addCharacter = async (character) => {
    try {
      await addToDb('characters', character);
    } catch (error) {
      console.error(error);
    }
  };

  document.addEventListener('submit', (event) => {
    event.preventDefault();
    if (event.target.matches('#addCharacterForm')) {
      const character = {
        name: event.target.elements.name.value,
        level: 1,
        experience: 0,
        luck: 7,
        maxHealth: 3,
        currentHealth: 3,
        maxStamina: 9,
        currentStamina: 9,
      };

      addCharacter(character);
    }
  });

  document.addEventListener('item-added', (event) => {
    const key = event.detail;
    window.location.href = `/character-sheets/select-race?key=${key}`;
  });
</script>
